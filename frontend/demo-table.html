<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ - –¢–∞–±–ª–∏—Ü—ã</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .tournament-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tournament-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin: 0 0 10px 0;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .bracket-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .bracket-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            vertical-align: middle;
            position: relative;
        }
        
        .match-cell {
            width: 150px;
            height: 60px;
            background: #f8f9fa;
        }
        
        .team-name {
            display: block;
            padding: 4px 8px;
            margin: 2px 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .team-name:hover {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .team-name.winner {
            background: #4caf50;
            color: white;
            font-weight: bold;
        }
        
        .team-name.loser {
            background: #f5f5f5;
            color: #999;
            text-decoration: line-through;
        }
        
        .round-header {
            background: #007bff;
            color: white;
            font-weight: bold;
            padding: 10px;
        }
        
        .connector {
            width: 30px;
            height: 60px;
            position: relative;
        }
        
        .connector::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 15px;
            height: 1px;
            background: #333;
        }
        
        .connector::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            width: 15px;
            height: 1px;
            background: #333;
        }
        
        .connector-vertical {
            width: 1px;
            height: 30px;
            background: #333;
            margin: 0 auto;
        }
        
        .bye-cell {
            background: #fffacd;
            font-style: italic;
            color: #666;
        }
        
        .champion {
            background: #ffd700 !important;
            color: #333 !important;
            font-weight: bold;
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px #ffd700; }
            to { box-shadow: 0 0 20px #ffd700; }
        }
        
        .match-info {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }
        
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="tournament-header">
        <h1 class="tournament-title">–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ Double Elimination</h1>
        <p>–°–∏—Å—Ç–µ–º–∞ –Ω–∞ –≤—ã–±—ã–≤–∞–Ω–∏–µ –¥–æ –¥–≤—É—Ö –ø–æ—Ä–∞–∂–µ–Ω–∏–π</p>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="createTournament(4)">4 –∫–æ–º–∞–Ω–¥—ã</button>
        <button class="btn" onclick="createTournament(8)">8 –∫–æ–º–∞–Ω–¥</button>
        <button class="btn" onclick="simulateMatch()">–°–ª—É—á–∞–π–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
        <button class="btn" onclick="resetTournament()">–°–±—Ä–æ—Å</button>
    </div>
    
    <div id="bracket-container">
        <p style="text-align: center; color: #666;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–Ω–∏—Ä–∞</p>
    </div>
    
    <div class="status" id="status">–ì–æ—Ç–æ–≤ –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ç—É—Ä–Ω–∏—Ä–∞</div>
    
    <script>
        let tournament = {
            teams: [],
            matches: [],
            winnersBracket: [],
            losersBracket: [],
            currentRound: 1,
            isComplete: false,
            champion: null
        };
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        function generateTeams(count) {
            const names = [
                '–ö–æ–º–∞–Ω–¥–∞ Alpha', '–ö–æ–º–∞–Ω–¥–∞ Beta', '–ö–æ–º–∞–Ω–¥–∞ Gamma', '–ö–æ–º–∞–Ω–¥–∞ Delta',
                '–ö–æ–º–∞–Ω–¥–∞ Epsilon', '–ö–æ–º–∞–Ω–¥–∞ Zeta', '–ö–æ–º–∞–Ω–¥–∞ Eta', '–ö–æ–º–∞–Ω–¥–∞ Theta'
            ];
            
            return Array.from({length: count}, (_, i) => ({
                id: i + 1,
                name: names[i] || `–ö–æ–º–∞–Ω–¥–∞ ${i + 1}`,
                eliminated: false,
                losses: 0
            }));
        }
        
        function createTournament(teamCount) {
            tournament.teams = generateTeams(teamCount);
            tournament.matches = [];
            tournament.isComplete = false;
            tournament.champion = null;
            
            generateMatches();
            renderBracket();
            updateStatus(`–¢—É—Ä–Ω–∏—Ä —Å–æ–∑–¥–∞–Ω: ${teamCount} –∫–æ–º–∞–Ω–¥`);
        }
        
        function generateMatches() {
            const teams = tournament.teams;
            let matchId = 1;
            
            // –ü–µ—Ä–≤—ã–π —Ä–∞—É–Ω–¥ Winners Bracket
            for (let i = 0; i < teams.length; i += 2) {
                if (i + 1 < teams.length) {
                    tournament.matches.push({
                        id: matchId++,
                        team1: teams[i],
                        team2: teams[i + 1],
                        winner: null,
                        loser: null,
                        bracket: 'winners',
                        round: 1,
                        status: 'ready',
                        nextWinnerMatch: null,
                        nextLoserMatch: null
                    });
                } else {
                    // BYE –¥–ª—è –Ω–µ—á–µ—Ç–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–∞–Ω–¥
                    tournament.matches.push({
                        id: matchId++,
                        team1: teams[i],
                        team2: null,
                        winner: teams[i],
                        loser: null,
                        bracket: 'winners',
                        round: 1,
                        status: 'bye',
                        nextWinnerMatch: null,
                        nextLoserMatch: null
                    });
                }
            }
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ä–∞—É–Ω–¥–æ–≤
            generateWinnersBracketStructure();
        }
        
        function generateWinnersBracketStructure() {
            const firstRoundMatches = tournament.matches.filter(m => m.bracket === 'winners' && m.round === 1);
            let currentRoundMatches = firstRoundMatches;
            let round = 2;
            let matchId = Math.max(...tournament.matches.map(m => m.id)) + 1;
            
            while (currentRoundMatches.length > 1) {
                const nextRoundMatches = [];
                
                for (let i = 0; i < currentRoundMatches.length; i += 2) {
                    const match1 = currentRoundMatches[i];
                    const match2 = currentRoundMatches[i + 1];
                    
                    if (match2) {
                        // –°–æ–∑–¥–∞–µ–º –º–∞—Ç—á –¥–ª—è –¥–≤—É—Ö –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
                        const nextMatch = {
                            id: matchId++,
                            team1: null, // –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –º–∞—Ç—á–µ–π
                            team2: null,
                            winner: null,
                            loser: null,
                            bracket: 'winners',
                            round: round,
                            status: 'waiting',
                            nextWinnerMatch: null,
                            nextLoserMatch: null,
                            sourceMatches: [match1.id, match2.id]
                        };
                        
                        tournament.matches.push(nextMatch);
                        nextRoundMatches.push(nextMatch);
                        
                        // –°–≤—è–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–∞—Ç—á–∏ —Å —ç—Ç–∏–º
                        match1.nextWinnerMatch = nextMatch.id;
                        match2.nextWinnerMatch = nextMatch.id;
                    } else {
                        // –ù–µ—á–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç—á–µ–π - –ø—Ä–æ—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                        nextRoundMatches.push(match1);
                    }
                }
                
                currentRoundMatches = nextRoundMatches;
                round++;
            }
        }
        
        function renderBracket() {
            const container = document.getElementById('bracket-container');
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –º–∞—Ç—á–∏ –ø–æ —Ä–∞—É–Ω–¥–∞–º
            const winnerRounds = {};
            const loserRounds = {};
            
            tournament.matches.forEach(match => {
                if (match.bracket === 'winners') {
                    if (!winnerRounds[match.round]) winnerRounds[match.round] = [];
                    winnerRounds[match.round].push(match);
                } else {
                    if (!loserRounds[match.round]) loserRounds[match.round] = [];
                    loserRounds[match.round].push(match);
                }
            });
            
            let html = '';
            
            // Winners Bracket Table
            html += '<h3 style="text-align: center; color: #007bff; margin: 20px 0;">Winners Bracket</h3>';
            html += '<table class="bracket-table">';
            
            const maxWinnerRounds = Object.keys(winnerRounds).length > 0 ? Math.max(...Object.keys(winnerRounds).map(Number)) : 0;
            
            if (maxWinnerRounds > 0) {
                // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞—É–Ω–¥–æ–≤
                html += '<tr>';
                for (let round = 1; round <= maxWinnerRounds; round++) {
                    html += `<td class="round-header">–†–∞—É–Ω–¥ ${round}</td>`;
                    if (round < maxWinnerRounds) {
                        html += '<td style="width: 30px;"></td>'; // –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª–µ–π
                    }
                }
                html += '</tr>';
                
                // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç—á–µ–π –≤ —Ä–∞—É–Ω–¥–µ
                const maxMatchesInRound = Math.max(...Object.keys(winnerRounds).map(round => winnerRounds[round].length));
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–∞—Ç—á–∏
                for (let matchIndex = 0; matchIndex < maxMatchesInRound; matchIndex++) {
                    html += '<tr>';
                    
                    for (let round = 1; round <= maxWinnerRounds; round++) {
                        const matches = winnerRounds[round] || [];
                        const match = matches[matchIndex];
                        
                        if (match) {
                            html += '<td class="match-cell">';
                            html += renderMatch(match);
                            html += '</td>';
                        } else {
                            html += '<td class="match-cell"></td>';
                        }
                        
                        if (round < maxWinnerRounds) {
                            html += '<td class="connector"></td>';
                        }
                    }
                    
                    html += '</tr>';
                }
            }
            
            html += '</table>';
            
            // Losers Bracket Table
            if (Object.keys(loserRounds).length > 0) {
                html += '<h3 style="text-align: center; color: #dc3545; margin: 20px 0;">Losers Bracket</h3>';
                html += '<table class="bracket-table">';
                
                const maxLoserRounds = Math.max(...Object.keys(loserRounds).map(Number));
                
                // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞—É–Ω–¥–æ–≤
                html += '<tr>';
                for (let round = 1; round <= maxLoserRounds; round++) {
                    html += `<td class="round-header">L-–†–∞—É–Ω–¥ ${round}</td>`;
                    if (round < maxLoserRounds) {
                        html += '<td style="width: 30px;"></td>';
                    }
                }
                html += '</tr>';
                
                // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç—á–µ–π –≤ —Ä–∞—É–Ω–¥–µ
                const maxLoserMatchesInRound = Math.max(...Object.keys(loserRounds).map(round => loserRounds[round].length));
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–∞—Ç—á–∏
                for (let matchIndex = 0; matchIndex < maxLoserMatchesInRound; matchIndex++) {
                    html += '<tr>';
                    
                    for (let round = 1; round <= maxLoserRounds; round++) {
                        const matches = loserRounds[round] || [];
                        const match = matches[matchIndex];
                        
                        if (match) {
                            html += '<td class="match-cell">';
                            html += renderMatch(match);
                            html += '</td>';
                        } else {
                            html += '<td class="match-cell"></td>';
                        }
                        
                        if (round < maxLoserRounds) {
                            html += '<td class="connector"></td>';
                        }
                    }
                    
                    html += '</tr>';
                }
                
                html += '</table>';
            }
            
            // –§–∏–Ω–∞–ª
            if (tournament.champion) {
                html += '<h3 style="text-align: center; color: #ffd700; margin: 20px 0;">üèÜ –ß–µ–º–ø–∏–æ–Ω —Ç—É—Ä–Ω–∏—Ä–∞ üèÜ</h3>';
                html += '<table class="bracket-table">';
                html += '<tr><td class="match-cell champion" style="text-align: center; font-size: 18px;">';
                html += `${tournament.champion.name}`;
                html += '</td></tr>';
                html += '</table>';
            }
            
            container.innerHTML = html;
        }
        
        function renderMatch(match) {
            if (match.status === 'bye') {
                return `<div class="bye-cell">BYE<br>${match.team1.name}</div>`;
            }
            
            let html = `<div class="match-info">–ú–∞—Ç—á ${match.id}</div>`;
            
            if (match.team1) {
                const team1Class = match.winner && match.winner.id === match.team1.id ? 'winner' : 
                                 match.loser && match.loser.id === match.team1.id ? 'loser' : '';
                html += `<div class="team-name ${team1Class}" onclick="setWinner(${match.id}, ${match.team1.id})">${match.team1.name}</div>`;
            }
            
            if (match.team2) {
                const team2Class = match.winner && match.winner.id === match.team2.id ? 'winner' : 
                                 match.loser && match.loser.id === match.team2.id ? 'loser' : '';
                html += `<div class="team-name ${team2Class}" onclick="setWinner(${match.id}, ${match.team2.id})">${match.team2.name}</div>`;
            }
            
            return html;
        }
        
        function setWinner(matchId, winnerId) {
            const match = tournament.matches.find(m => m.id === matchId);
            if (!match || match.winner) return;
            
            const winner = tournament.teams.find(t => t.id === winnerId);
            const loser = match.team1 && match.team1.id === winnerId ? match.team2 : match.team1;
            
            match.winner = winner;
            match.loser = loser;
            match.status = 'completed';
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä–∞–∂–µ–Ω–∏–π —É –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ
            if (loser) {
                loser.losses++;
                if (loser.losses >= 2) {
                    loser.eliminated = true;
                }
            }
            
            // –ü—Ä–æ–¥–≤–∏–≥–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ —Å–ª–µ–¥—É—é—â–∏–π –º–∞—Ç—á Winners Bracket
            if (match.nextWinnerMatch) {
                const nextMatch = tournament.matches.find(m => m.id === match.nextWinnerMatch);
                if (nextMatch) {
                    if (!nextMatch.team1) {
                        nextMatch.team1 = winner;
                    } else if (!nextMatch.team2) {
                        nextMatch.team2 = winner;
                        nextMatch.status = 'ready'; // –ú–∞—Ç—á –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—é
                    }
                }
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ –≤ Losers Bracket (–µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ)
            if (loser && loser.losses === 1) {
                createLosersBracketMatch(loser, match.round);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞
            checkTournamentComplete();
            
            renderBracket();
            updateStatus(`${winner.name} –ø–æ–±–µ–¥–∏–ª –≤ –º–∞—Ç—á–µ ${matchId}`);
        }
        
        function createLosersBracketMatch(loser, winnerRound) {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è Losers Bracket
            const existingLoserMatch = tournament.matches.find(m => 
                m.bracket === 'losers' && 
                m.round === winnerRound && 
                (!m.team1 || !m.team2)
            );
            
            if (existingLoserMatch) {
                if (!existingLoserMatch.team1) {
                    existingLoserMatch.team1 = loser;
                } else if (!existingLoserMatch.team2) {
                    existingLoserMatch.team2 = loser;
                    existingLoserMatch.status = 'ready';
                }
            } else {
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Ç—á –≤ Losers Bracket
                const matchId = Math.max(...tournament.matches.map(m => m.id)) + 1;
                tournament.matches.push({
                    id: matchId,
                    team1: loser,
                    team2: null,
                    winner: null,
                    loser: null,
                    bracket: 'losers',
                    round: winnerRound,
                    status: 'waiting',
                    nextWinnerMatch: null,
                    nextLoserMatch: null
                });
            }
        }
        

        
        function checkTournamentComplete() {
            const activePlayers = tournament.teams.filter(t => !t.eliminated);
            
            if (activePlayers.length === 1) {
                tournament.champion = activePlayers[0];
                tournament.isComplete = true;
                updateStatus(`–¢—É—Ä–Ω–∏—Ä –∑–∞–≤–µ—Ä—à–µ–Ω! –ß–µ–º–ø–∏–æ–Ω: ${tournament.champion.name}`);
            }
        }
        
        function simulateMatch() {
            const readyMatches = tournament.matches.filter(m => m.status === 'ready' && !m.winner);
            
            if (readyMatches.length === 0) {
                updateStatus('–ù–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö –º–∞—Ç—á–µ–π –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏');
                return;
            }
            
            const match = readyMatches[0];
            if (match.team1 && match.team2) {
                const winnerId = Math.random() < 0.5 ? match.team1.id : match.team2.id;
                setWinner(match.id, winnerId);
            }
        }
        
        function resetTournament() {
            tournament = {
                teams: [],
                matches: [],
                winnersBracket: [],
                losersBracket: [],
                currentRound: 1,
                isComplete: false,
                champion: null
            };
            
            document.getElementById('bracket-container').innerHTML = 
                '<p style="text-align: center; color: #666;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–Ω–∏—Ä–∞</p>';
            updateStatus('–ì–æ—Ç–æ–≤ –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ç—É—Ä–Ω–∏—Ä–∞');
        }
        
        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        createTournament(4);
                        break;
                    case '2':
                        e.preventDefault();
                        createTournament(8);
                        break;
                    case 'r':
                        e.preventDefault();
                        simulateMatch();
                        break;
                    case 'Backspace':
                        e.preventDefault();
                        resetTournament();
                        break;
                }
            }
        });
    </script>
</body>
</html>