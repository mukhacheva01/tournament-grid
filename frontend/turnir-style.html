<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ - –°—Ç–∏–ª—å Turnir-Online</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
            font-size: 12px;
            background-color: #ffffff;
        }
        
        .tournament-info {
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid #000;
            padding: 10px;
        }
        
        .tournament-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .controls {
            margin: 10px 0;
            text-align: center;
        }
        
        .btn {
            background: #f0f0f0;
            border: 1px solid #999;
            padding: 5px 10px;
            margin: 2px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .btn:hover {
            background: #e0e0e0;
        }
        
        .bracket-container {
            overflow-x: auto;
            margin: 0 auto;
            padding: 10px;
        }
        
        .bracket-grid {
            display: table;
            border-collapse: collapse;
            margin: 0 auto;
            border: 1px solid #000;
            white-space: nowrap;
        }
        
        .bracket-column {
            display: table-cell;
            vertical-align: top;
            border-right: 1px solid #000;
            padding: 5px;
            min-width: 120px;
        }
        
        .bracket-column:last-child {
            border-right: none;
        }
        
        .round-header {
            background: #E6E6FA;
            font-weight: bold;
            padding: 5px;
            text-align: center;
            border: 1px solid #000;
            margin-bottom: 5px;
        }
        
        .match-cell {
            border: 1px solid #000;
            padding: 2px;
            margin-bottom: 10px;
            position: relative;
            background: white;
            min-height: 50px;
        }
        
        .match-number {
            font-size: 10px;
            color: #666;
            position: absolute;
            top: 1px;
            left: 2px;
        }
        
        .team-slot {
            display: block;
            padding: 1px 3px;
            margin: 1px 0;
            border: 1px solid #ccc;
            background: #fff;
            cursor: pointer;
            font-size: 11px;
            min-height: 12px;
        }
        
        .team-slot:hover {
            background: #f0f8ff;
        }
        
        .team-slot.winner {
            background: #90EE90;
            font-weight: bold;
        }
        
        .team-slot.loser {
            background: #FFB6C1;
            text-decoration: line-through;
            color: #666;
        }
        
        .bye-slot {
            background: #FFFACD;
            font-style: italic;
            color: #888;
        }
        

        
        .winners-bracket {
            margin-bottom: 20px;
        }
        
        .losers-bracket {
            margin-bottom: 20px;
        }
        
        .final-bracket {
            margin-top: 20px;
        }
        
        .champion {
            background: #FFD700 !important;
            font-weight: bold;
            font-size: 14px;
            padding: 10px;
            text-align: center;
            border: 2px solid #FFA500;
        }
        
        .bracket-label {
            font-weight: bold;
            text-align: center;
            margin: 10px 0 5px 0;
            padding: 5px;
            background: #f0f0f0;
            border: 1px solid #999;
        }
        
        .connector-line {
            width: 20px;
            height: 1px;
            background: #000;
            margin: 0 auto;
        }
        
        .status-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #f0f0f0;
            border: 1px solid #999;
            padding: 5px;
            font-size: 10px;
            max-width: 200px;
        }
        
        .participants-count {
            text-align: right;
            font-size: 11px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="tournament-info">
        <div class="tournament-title">–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ "Double Elimination" (–¥–æ –¥–≤—É—Ö –ø–æ—Ä–∞–∂–µ–Ω–∏–π)</div>
        <div>–°–∏—Å—Ç–µ–º–∞ –Ω–∞ –≤—ã–±—ã–≤–∞–Ω–∏–µ —Å —Å–µ—Ç–∫–æ–π –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö</div>
    </div>
    
    <div class="participants-count" id="participants-info">
        –£—á–∞—Å—Ç–Ω–∏–∫–∏: <span id="team-count">0</span>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="createTournament(4)">4 –∫–æ–º–∞–Ω–¥—ã</button>
        <button class="btn" onclick="createTournament(8)">8 –∫–æ–º–∞–Ω–¥</button>
        <button class="btn" onclick="createTournament(16)">16 –∫–æ–º–∞–Ω–¥</button>
        <button class="btn" onclick="simulateMatch()">–°–ª—É—á–∞–π–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
        <button class="btn" onclick="resetTournament()">–°–±—Ä–æ—Å</button>
        <button class="btn" onclick="hideControls()">–°–∫—Ä—ã—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
    </div>
    
    <div id="bracket-container">
        <p style="text-align: center; color: #666; font-style: italic;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–Ω–∏—Ä–∞</p>
    </div>
    
    <div class="status-info" id="status">
        <strong>–°—Ç–∞—Ç—É—Å:</strong><br>
        –ì–æ—Ç–æ–≤ –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ç—É—Ä–Ω–∏—Ä–∞
    </div>
    
    <script>
        let tournament = {
            teams: [],
            matches: [],
            currentMatchId: 1,
            isComplete: false,
            champion: null
        };
        
        function updateStatus(message) {
            document.getElementById('status').innerHTML = `<strong>–°—Ç–∞—Ç—É—Å:</strong><br>${message}`;
        }
        
        function generateTeams(count) {
            const names = [
                '–ö–æ–º–∞–Ω–¥–∞ A', '–ö–æ–º–∞–Ω–¥–∞ B', '–ö–æ–º–∞–Ω–¥–∞ C', '–ö–æ–º–∞–Ω–¥–∞ D',
                '–ö–æ–º–∞–Ω–¥–∞ E', '–ö–æ–º–∞–Ω–¥–∞ F', '–ö–æ–º–∞–Ω–¥–∞ G', '–ö–æ–º–∞–Ω–¥–∞ H',
                '–ö–æ–º–∞–Ω–¥–∞ I', '–ö–æ–º–∞–Ω–¥–∞ J', '–ö–æ–º–∞–Ω–¥–∞ K', '–ö–æ–º–∞–Ω–¥–∞ L',
                '–ö–æ–º–∞–Ω–¥–∞ M', '–ö–æ–º–∞–Ω–¥–∞ N', '–ö–æ–º–∞–Ω–¥–∞ O', '–ö–æ–º–∞–Ω–¥–∞ P'
            ];
            
            return Array.from({length: count}, (_, i) => ({
                id: i + 1,
                name: names[i] || `–ö–æ–º–∞–Ω–¥–∞ ${i + 1}`,
                eliminated: false,
                losses: 0,
                seed: i + 1
            }));
        }
        
        function createTournament(teamCount) {
            tournament.teams = generateTeams(teamCount);
            tournament.matches = [];
            tournament.currentMatchId = 1;
            tournament.isComplete = false;
            tournament.champion = null;
            
            document.getElementById('team-count').textContent = teamCount;
            
            generateFullTournamentStructure();
            renderBracket();
            updateStatus(`–¢—É—Ä–Ω–∏—Ä —Å–æ–∑–¥–∞–Ω: ${teamCount} –∫–æ–º–∞–Ω–¥. –í—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞. –ù–∞—á–∏–Ω–∞–π—Ç–µ –º–∞—Ç—á–∏.`);
        }
        
        function generateBracketStructure() {
            tournament.matches = [];
            tournament.currentMatchId = 1;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç—É—Ä–Ω–∏—Ä–∞ –∑–∞—Ä–∞–Ω–µ–µ
            generateFullTournamentStructure();
        }
        
        function generateFullTournamentStructure() {
            const teamCount = tournament.teams.length;
            const winnersRounds = Math.ceil(Math.log2(teamCount));
            const losersRounds = winnersRounds * 2 - 1;
            
            // –°–æ–∑–¥–∞–µ–º Winners Bracket
            generateWinnersBracketStructure(winnersRounds);
            
            // –°–æ–∑–¥–∞–µ–º Losers Bracket
            generateLosersBracketStructure(losersRounds);
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–≤—ã–π —Ä–∞—É–Ω–¥ Winners Bracket –∫–æ–º–∞–Ω–¥–∞–º–∏
            fillFirstRound();
        }
        
        function generateWinnersBracketStructure(rounds) {
            let matchesInRound = Math.ceil(tournament.teams.length / 2);
            
            for (let round = 1; round <= rounds; round++) {
                for (let pos = 0; pos < matchesInRound; pos++) {
                    const match = {
                        id: tournament.currentMatchId++,
                        team1: null,
                        team2: null,
                        winner: null,
                        loser: null,
                        bracket: 'winners',
                        round: round,
                        status: 'waiting',
                        position: pos
                    };
                    tournament.matches.push(match);
                }
                matchesInRound = Math.ceil(matchesInRound / 2);
            }
        }
        
        function generateLosersBracketStructure(rounds) {
            for (let round = 1; round <= rounds; round++) {
                let matchesInRound;
                if (round === 1) {
                    matchesInRound = Math.floor(tournament.teams.length / 4);
                } else if (round % 2 === 0) {
                    // –ß–µ—Ç–Ω—ã–µ —Ä–∞—É–Ω–¥—ã - –º–µ–Ω—å—à–µ –º–∞—Ç—á–µ–π
                    matchesInRound = Math.ceil(tournament.teams.length / Math.pow(2, round + 1));
                } else {
                    // –ù–µ—á–µ—Ç–Ω—ã–µ —Ä–∞—É–Ω–¥—ã - –±–æ–ª—å—à–µ –º–∞—Ç—á–µ–π
                    matchesInRound = Math.ceil(tournament.teams.length / Math.pow(2, round));
                }
                
                if (matchesInRound < 1) matchesInRound = 1;
                
                for (let pos = 0; pos < matchesInRound; pos++) {
                    const match = {
                        id: tournament.currentMatchId++,
                        team1: null,
                        team2: null,
                        winner: null,
                        loser: null,
                        bracket: 'losers',
                        round: round,
                        status: 'waiting',
                        position: pos
                    };
                    tournament.matches.push(match);
                }
            }
        }
        
        function fillFirstRound() {
            const firstRoundMatches = tournament.matches.filter(m => 
                m.bracket === 'winners' && m.round === 1
            ).sort((a, b) => a.position - b.position);
            
            for (let i = 0; i < tournament.teams.length; i += 2) {
                const matchIndex = Math.floor(i / 2);
                if (matchIndex < firstRoundMatches.length) {
                    const match = firstRoundMatches[matchIndex];
                    match.team1 = tournament.teams[i];
                    match.team2 = tournament.teams[i + 1] || null;
                    
                    if (match.team2) {
                        match.status = 'ready';
                    } else {
                        match.status = 'bye';
                        match.winner = match.team1;
                    }
                }
            }
        }
        
        function generateWinnersBracketRounds() {
            let currentRound = 1;
            let currentMatches = tournament.matches.filter(m => m.bracket === 'winners' && m.round === 1);
            
            while (currentMatches.length > 1) {
                currentRound++;
                const nextRoundMatches = [];
                
                for (let i = 0; i < currentMatches.length; i += 2) {
                    const match1 = currentMatches[i];
                    const match2 = currentMatches[i + 1];
                    
                    if (match2) {
                        const nextMatch = {
                            id: tournament.currentMatchId++,
                            team1: null,
                            team2: null,
                            winner: null,
                            loser: null,
                            bracket: 'winners',
                            round: currentRound,
                            status: 'waiting',
                            position: Math.floor(i / 2),
                            sourceMatches: [match1.id, match2.id]
                        };
                        
                        tournament.matches.push(nextMatch);
                        nextRoundMatches.push(nextMatch);
                        
                        match1.nextMatch = nextMatch.id;
                        match2.nextMatch = nextMatch.id;
                    } else {
                        nextRoundMatches.push(match1);
                    }
                }
                
                currentMatches = nextRoundMatches;
            }
        }
        
        function renderBracket() {
            const container = document.getElementById('bracket-container');
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –º–∞—Ç—á–∏ –ø–æ bracket –∏ round
            const winnerRounds = {};
            const loserRounds = {};
            
            tournament.matches.forEach(match => {
                if (match.bracket === 'winners') {
                    if (!winnerRounds[match.round]) winnerRounds[match.round] = [];
                    winnerRounds[match.round].push(match);
                } else if (match.bracket === 'losers') {
                    if (!loserRounds[match.round]) loserRounds[match.round] = [];
                    loserRounds[match.round].push(match);
                }
            });
            
            let html = '';
            
            // –°–æ–∑–¥–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: Losers —Å–ª–µ–≤–∞, Winners —Å–ø—Ä–∞–≤–∞
            html += '<div style="display: flex; gap: 20px; justify-content: center;">';
            
            // Losers Bracket —Å–ª–µ–≤–∞
            if (Object.keys(loserRounds).length > 0) {
                html += '<div style="flex: 1;">';
                html += '<div class="bracket-label">Losers Bracket</div>';
                html += '<div class="losers-bracket">';
                html += renderBracketGrid(loserRounds, 'L');
                html += '</div>';
                html += '</div>';
            }
            
            // Winners Bracket —Å–ø—Ä–∞–≤–∞
            if (Object.keys(winnerRounds).length > 0) {
                html += '<div style="flex: 1;">';
                html += '<div class="bracket-label">Winners Bracket</div>';
                html += '<div class="winners-bracket">';
                html += renderBracketGrid(winnerRounds, 'W');
                html += '</div>';
                html += '</div>';
            }
            
            html += '</div>';
            
            // –§–∏–Ω–∞–ª
            if (tournament.champion) {
                html += '<div class="bracket-label">üèÜ –ß–µ–º–ø–∏–æ–Ω —Ç—É—Ä–Ω–∏—Ä–∞ üèÜ</div>';
                html += '<div class="final-bracket">';
                html += `<div class="champion">${tournament.champion.name}</div>`;
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        function renderBracketGrid(rounds, prefix) {
            const roundNumbers = Object.keys(rounds).map(Number).sort((a, b) => a - b);
            
            let html = '<div class="bracket-container">';
            html += '<div class="bracket-grid">';
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞—É–Ω–¥–∞
            roundNumbers.forEach((round, roundIndex) => {
                const matches = rounds[round] || [];
                
                html += '<div class="bracket-column">';
                html += `<div class="round-header">${prefix}${round}</div>`;
                
                matches.forEach(match => {
                    html += '<div class="match-cell">';
                    html += renderMatch(match);
                    html += '</div>';
                });
                
                html += '</div>';
            });
            
            html += '</div>';
            html += '</div>';
            return html;
        }
        
        function renderMatch(match) {
            let html = `<div class="match-number">${match.id}</div>`;
            
            if (match.status === 'bye') {
                html += `<div class="team-slot bye-slot">BYE</div>`;
                html += `<div class="team-slot winner">${match.team1.name}</div>`;
                return html;
            }
            
            if (match.team1) {
                const team1Class = match.winner && match.winner.id === match.team1.id ? 'winner' : 
                                 match.loser && match.loser.id === match.team1.id ? 'loser' : '';
                html += `<div class="team-slot ${team1Class}" onclick="setWinner(${match.id}, ${match.team1.id})">${match.team1.name}</div>`;
            } else {
                html += '<div class="team-slot" style="color: #ccc;">–û–∂–∏–¥–∞–Ω–∏–µ</div>';
            }
            
            if (match.team2) {
                const team2Class = match.winner && match.winner.id === match.team2.id ? 'winner' : 
                                 match.loser && match.loser.id === match.team2.id ? 'loser' : '';
                html += `<div class="team-slot ${team2Class}" onclick="setWinner(${match.id}, ${match.team2.id})">${match.team2.name}</div>`;
            } else if (match.status !== 'bye') {
                html += '<div class="team-slot" style="color: #ccc;">–û–∂–∏–¥–∞–Ω–∏–µ</div>';
            }
            
            return html;
        }
        
        function setWinner(matchId, winnerId) {
            const match = tournament.matches.find(m => m.id === matchId);
            if (!match || match.winner || (match.status !== 'ready' && match.status !== 'bye')) return;
            
            const winner = tournament.teams.find(t => t.id === winnerId);
            const loser = match.team1 && match.team1.id === winnerId ? match.team2 : match.team1;
            
            match.winner = winner;
            match.loser = loser;
            match.status = 'completed';
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ä–∞–∂–µ–Ω–∏—è
            if (loser) {
                loser.losses++;
                if (loser.losses >= 2) {
                    loser.eliminated = true;
                }
            }
            
            // –ü—Ä–æ–¥–≤–∏–≥–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ Winners Bracket
            if (match.bracket === 'winners') {
                advanceWinnerInWinnersBracket(winner, match.round, match.position);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ –≤ Losers Bracket
                if (loser && loser.losses === 1) {
                    sendToLosersBracket(loser, match.round);
                }
            }
            
            // –ü—Ä–æ–¥–≤–∏–≥–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ Losers Bracket
            if (match.bracket === 'losers') {
                advanceWinnerInLosersBracket(winner, match.round, match.position);
            }
            
            checkTournamentComplete();
            renderBracket();
            updateStatus(`–ú–∞—Ç—á ${matchId}: ${winner.name} –ø–æ–±–µ–¥–∏–ª`);
        }
        
        function advanceWinnerInWinnersBracket(winner, currentRound, currentPosition) {
            const nextRound = currentRound + 1;
            const nextPosition = Math.floor(currentPosition / 2);
            
            const nextMatch = tournament.matches.find(m => 
                m.bracket === 'winners' && 
                m.round === nextRound && 
                m.position === nextPosition
            );
            
            if (nextMatch) {
                if (!nextMatch.team1) {
                    nextMatch.team1 = winner;
                } else if (!nextMatch.team2) {
                    nextMatch.team2 = winner;
                    nextMatch.status = 'ready';
                }
            }
        }
        
        function advanceWinnerInLosersBracket(winner, currentRound, currentPosition) {
            const nextRound = currentRound + 1;
            const maxLosersRounds = Math.ceil(Math.log2(tournament.teams.length)) * 2 - 1;
            
            if (nextRound <= maxLosersRounds) {
                const nextMatch = tournament.matches.find(m => 
                    m.bracket === 'losers' && 
                    m.round === nextRound && 
                    (!m.team1 || !m.team2)
                );
                
                if (nextMatch) {
                    if (!nextMatch.team1) {
                        nextMatch.team1 = winner;
                    } else if (!nextMatch.team2) {
                        nextMatch.team2 = winner;
                        nextMatch.status = 'ready';
                    }
                }
            }
        }
        
        function sendToLosersBracket(loser, winnersRound) {
            // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ Double Elimination:
            // W1 –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ -> L1
            // W2 –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ -> L2 (–∏–≥—Ä–∞—é—Ç —Å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏ L1)
            // W3 –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ -> L4 (–∏–≥—Ä–∞—é—Ç —Å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏ L3)
            // W4 –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ -> L6 (–∏–≥—Ä–∞—é—Ç —Å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏ L5)
            
            let targetRound;
            if (winnersRound === 1) {
                targetRound = 1;
            } else {
                // –ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ –∏–∑ Wn –∏–¥—É—Ç –≤ L(2n-2)
                targetRound = (winnersRound - 1) * 2;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –º–∞—Ç—á –≤ –Ω—É–∂–Ω–æ–º —Ä–∞—É–Ω–¥–µ
            let targetMatch = tournament.matches.find(m => 
                m.bracket === 'losers' && 
                m.round === targetRound && 
                (!m.team1 || !m.team2)
            );
            
            if (!targetMatch) {
                targetMatch = {
                    id: tournament.currentMatchId++,
                    team1: null,
                    team2: null,
                    winner: null,
                    loser: null,
                    bracket: 'losers',
                    round: targetRound,
                    status: 'waiting',
                    position: 0
                };
                tournament.matches.push(targetMatch);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –≤ –º–∞—Ç—á
            if (!targetMatch.team1) {
                targetMatch.team1 = loser;
            } else if (!targetMatch.team2) {
                targetMatch.team2 = loser;
                targetMatch.status = 'ready';
            }
            
            // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–≤—ã–π —Ä–∞—É–Ω–¥, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞ Losers
            if (winnersRound > 1) {
                addWinnerFromPreviousLosersRound(targetMatch, targetRound);
            }
        }
        
        function findOrCreateLoserMatch(round, team) {
            // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞—Ç—á
            let match = tournament.matches.find(m => 
                m.bracket === 'losers' && 
                m.round === round && 
                (!m.team1 || !m.team2)
            );
            
            if (!match) {
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Ç—á
                match = {
                    id: tournament.currentMatchId++,
                    team1: team,
                    team2: null,
                    winner: null,
                    loser: null,
                    bracket: 'losers',
                    round: round,
                    status: 'waiting',
                    position: 0
                };
                tournament.matches.push(match);
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞—Ç—á
                if (!match.team1) {
                    match.team1 = team;
                } else if (!match.team2) {
                    match.team2 = team;
                    match.status = 'ready';
                }
            }
            
            return match;
        }
        
        function addWinnerFromPreviousLosersRound(match, currentRound) {
            // –ù–∞—Ö–æ–¥–∏–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞ Losers Bracket
            const prevRound = currentRound - 1;
            const prevWinner = tournament.matches.find(m => 
                m.bracket === 'losers' && 
                m.round === prevRound && 
                m.winner
            );
            
            if (prevWinner && prevWinner.winner) {
                if (!match.team1) {
                    match.team1 = prevWinner.winner;
                } else if (!match.team2) {
                    match.team2 = prevWinner.winner;
                    match.status = 'ready';
                }
            }
        }
        
        function getNextLosersBracketRound(currentRound) {
            // –í Losers Bracket —Ä–∞—É–Ω–¥—ã –∏–¥—É—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
            // –ù–æ –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É Double Elimination
            const maxLosersRounds = Math.ceil(Math.log2(tournament.teams.length)) * 2 - 1;
            
            if (currentRound < maxLosersRounds) {
                return currentRound + 1;
            }
            
            return null; // –§–∏–Ω–∞–ª Losers Bracket
        }
        
        function getWinnersRoundForLosersRound(losersRound) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∏–∑ –∫–∞–∫–æ–≥–æ —Ä–∞—É–Ω–¥–∞ Winners Bracket –ø—Ä–∏—Ö–æ–¥—è—Ç –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ
            if (losersRound % 2 === 1 && losersRound > 1) {
                // –ù–µ—á–µ—Ç–Ω—ã–µ —Ä–∞—É–Ω–¥—ã L3, L5, L7... –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö –∏–∑ W2, W3, W4...
                return Math.ceil(losersRound / 2) + 1;
            }
            return null;
        }
        
        function checkTournamentComplete() {
            const activePlayers = tournament.teams.filter(t => !t.eliminated);
            
            if (activePlayers.length === 1) {
                tournament.champion = activePlayers[0];
                tournament.isComplete = true;
                updateStatus(`üèÜ –¢—É—Ä–Ω–∏—Ä –∑–∞–≤–µ—Ä—à–µ–Ω! –ß–µ–º–ø–∏–æ–Ω: ${tournament.champion.name}`);
            }
        }
        
        function simulateMatch() {
            const readyMatches = tournament.matches.filter(m => m.status === 'ready' && !m.winner);
            
            if (readyMatches.length === 0) {
                updateStatus('–ù–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö –º–∞—Ç—á–µ–π –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏');
                return;
            }
            
            const match = readyMatches[0];
            if (match.team1 && match.team2) {
                const winnerId = Math.random() < 0.5 ? match.team1.id : match.team2.id;
                setWinner(match.id, winnerId);
            }
        }
        
        function resetTournament() {
            tournament = {
                teams: [],
                matches: [],
                currentMatchId: 1,
                isComplete: false,
                champion: null
            };
            
            document.getElementById('team-count').textContent = '0';
            document.getElementById('bracket-container').innerHTML = 
                '<p style="text-align: center; color: #666; font-style: italic;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–Ω–∏—Ä–∞</p>';
            updateStatus('–ì–æ—Ç–æ–≤ –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ç—É—Ä–Ω–∏—Ä–∞');
        }
        
        function hideControls() {
            const controls = document.querySelector('.controls');
            const status = document.getElementById('status');
            
            if (controls.style.display === 'none') {
                controls.style.display = 'block';
                status.style.display = 'block';
            } else {
                controls.style.display = 'none';
                status.style.display = 'none';
            }
        }
        
        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        createTournament(4);
                        break;
                    case '2':
                        e.preventDefault();
                        createTournament(8);
                        break;
                    case '3':
                        e.preventDefault();
                        createTournament(16);
                        break;
                    case 'r':
                        e.preventDefault();
                        simulateMatch();
                        break;
                    case 'h':
                        e.preventDefault();
                        hideControls();
                        break;
                    case 'Backspace':
                        e.preventDefault();
                        resetTournament();
                        break;
                }
            }
        });
    </script>
</body>
</html>